//////////////////////////////////////////////////////////////////////////////////	 
//本程序只供学习使用，未经作者许可，不得用于其它任何用途
//中景园电子
//店铺地址：http://shop73023976.taobao.com/?spm=2013.1.0.0.M4PqC2
//
//  文 件 名   : main.c
//  版 本 号   : v2.0
//  作    者   : HuangKai
//  生成日期   : 2014-0101
//  最近修改   : 
//  功能描述   : OLED 4接口演示例程(51系列)
//              说明: 
//              ----------------------------------------------------------------
//              GND    电源地
//              VCC  接5V或3.3v电源
//              D0   接PD6（SCL）
//              D1   接PD7（SDA）
//              RES  接PD4
//              DC   接PD5
//              CS   接PD3               
//              ----------------------------------------------------------------
// 修改历史   :
// 日    期   : 
// 作    者   : HuangKai
// 修改内容   : 创建文件
//版权所有，盗版必究。
//Copyright(C) 中景园电子2014/3/16
//All rights reserved
//******************************************************************************/

#include "bsp_oled.h"
#include "bsp_oledfont.h"
#include "bsp.h"

#ifndef BMP
unsigned char BMP1[1024] =
{
	0x00,0x03,0x05,0x09,0x11,0xFF,0x11,0x89,0x05,0xC3,0x00,0xE0,0x00,0xF0,0x00,0xF8,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x44,0x28,0xFF,0x11,0xAA,0x44,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x83,0x01,0x38,0x44,0x82,0x92,
	0x92,0x74,0x01,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x44,0xFF,0x01,0x7D,
	0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x7D,0x01,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,
	0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x3F,0x03,0x03,
	0xF3,0x13,0x11,0x11,0x11,0x11,0x11,0x11,0x01,0xF1,0x11,0x61,0x81,0x01,0x01,0x01,
	0x81,0x61,0x11,0xF1,0x01,0x01,0x01,0x01,0x41,0x41,0xF1,0x01,0x01,0x01,0x01,0x01,
	0xC1,0x21,0x11,0x11,0x11,0x11,0x21,0xC1,0x01,0x01,0x01,0x01,0x41,0x41,0xF1,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x11,0x11,0x11,0x11,0x11,0xD3,0x33,
	0x03,0x03,0x3F,0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xE0,0x00,0x00,
	0x7F,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x7F,0x00,0x00,0x01,0x06,0x18,0x06,
	0x01,0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x00,0x00,0x00,
	0x1F,0x20,0x40,0x40,0x40,0x40,0x20,0x1F,0x00,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,
	0x40,0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x00,0x40,0x30,0x0C,0x03,0x00,0x00,
	0x00,0x00,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x06,0x06,
	0x06,0x06,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x84,0x44,0x44,0x44,
	0x84,0x04,0x04,0x04,0x84,0xC4,0x04,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,
	0x04,0x04,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x04,0x04,0x04,0x84,0x44,
	0x44,0x44,0x84,0x04,0x04,0x84,0x44,0x44,0x44,0x84,0x04,0x04,0x04,0x04,0x06,0x06,
	0x06,0x06,0x07,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x10,0x18,0x14,0x12,0x11,0x00,0x00,0x0F,0x10,0x10,0x10,
	0x0F,0x00,0x00,0x00,0x10,0x1F,0x10,0x00,0x00,0x00,0x08,0x10,0x12,0x12,0x0D,0x00,
	0x00,0x18,0x00,0x00,0x0D,0x12,0x12,0x12,0x0D,0x00,0x00,0x18,0x00,0x00,0x10,0x18,
	0x14,0x12,0x11,0x00,0x00,0x10,0x18,0x14,0x12,0x11,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,0x00,0x00,0x38,0x54,0x54,0x58,0x00,0x00,
	0x7C,0x04,0x04,0x78,0x00,0x00,0x3C,0x40,0x40,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xAA,0xAA,0xAA,
	0x28,0x08,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,
	0x00,0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00,0x7F,0x02,0x04,0x08,0x10,0x7F,0x00,/********************************/
};

unsigned char BMP2[1024] =
{
	0x00,0x03,0x05,0x09,0x11,0xFF,0x11,0x89,0x05,0xC3,0x00,0xE0,0x00,0xF0,0x00,0xF8,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x44,0x28,0xFF,0x11,0xAA,0x44,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x83,0x01,0x38,0x44,0x82,0x92,
	0x92,0x74,0x01,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x44,0xFF,0x01,0x7D,
	0x7D,0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x01,0x7D,0x7D,0x7D,0x7D,0x01,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,
	0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,
	0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0xF8,0x18,0x60,0x80,0x00,0x00,0x00,0x80,
	0x60,0x18,0xF8,0x00,0x00,0x00,0x20,0x20,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,
	0x10,0x08,0x08,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x20,0x20,0xF8,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x88,0x68,
	0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,
	0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x7F,0x00,0x00,0x01,0x06,0x18,0x06,0x01,
	0x00,0x00,0x7F,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x00,0x00,0x00,0x00,0x1F,
	0x20,0x40,0x40,0x40,0x40,0x20,0x1F,0x00,0x00,0x00,0x40,0x40,0x7F,0x40,0x40,0x00,
	0x00,0x00,0x00,0x00,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x18,0x06,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x40,0x20,0x20,0x20,0xC0,0x00,0x00,0xE0,0x20,0x20,0x20,
	0xE0,0x00,0x00,0x00,0x40,0xE0,0x00,0x00,0x00,0x00,0x60,0x20,0x20,0x20,0xE0,0x00,
	0x00,0x00,0x00,0x00,0xE0,0x20,0x20,0x20,0xE0,0x00,0x00,0x00,0x00,0x00,0x40,0x20,
	0x20,0x20,0xC0,0x00,0x00,0x40,0x20,0x20,0x20,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x0C,0x0A,0x0A,0x09,0x0C,0x00,0x00,0x0F,0x08,0x08,0x08,
	0x0F,0x00,0x00,0x00,0x08,0x0F,0x08,0x00,0x00,0x00,0x0C,0x08,0x09,0x09,0x0E,0x00,
	0x00,0x0C,0x00,0x00,0x0F,0x09,0x09,0x09,0x0F,0x00,0x00,0x0C,0x00,0x00,0x0C,0x0A,
	0x0A,0x09,0x0C,0x00,0x00,0x0C,0x0A,0x0A,0x09,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,0x00,0x00,0x38,0x54,0x54,0x58,0x00,0x00,
	0x7C,0x04,0x04,0x78,0x00,0x00,0x3C,0x40,0x40,0x7C,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xAA,0xAA,0xAA,
	0x28,0x08,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x03,0x0C,0x30,0x0C,0x03,0x7F,
	0x00,0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00,0x7F,0x02,0x04,0x08,0x10,0x7F,0x00,/***************************************/
	
};
#endif

static void OLED_WR_Byte (uint8_t data, uint8_t cmd);
static void OLED_Set_Pos(unsigned char x, unsigned char y);
static void OLED_ShowChar(uint8_t x, uint8_t y, uint8_t chr);
static void OLED_ShowString(uint8_t x, uint8_t y, uint8_t *chr);
static void OLED_ShowChinese(uint8_t x, uint8_t y, uint8_t no);
static uint32_t OLED_Pow(uint8_t m,uint8_t n);
static void OLED_ShowNum(uint8_t x, uint8_t y, uint32_t num);
static void OLED_ShowPic(u8 x,u8 y,u8 chNum);
#ifndef BMP
static void OLED_ShowBMP(unsigned char x0, unsigned char y0, unsigned char x1, unsigned char y1, unsigned char BMP[]);
#endif
static uint8_t OLED_Print_Chinese( uint8_t startX, uint8_t startY, uint8_t Chinese_Index[], uint8_t Length );
static uint8_t OLED_Print_Char( uint8_t startX, uint8_t startY, uint8_t Str[], uint8_t Length );

//向SSD1106写入一个字节。
//dat:要写入的数据/命令
//cmd:数据/命令标志 0,表示命令;1,表示数据;
static void OLED_WR_Byte (uint8_t data, uint8_t cmd)
{
	uint8_t i;
	if(cmd)   //判断写入数据还是命令
	{
		OLED_DC_Set();
	}
	else
	{
		OLED_DC_Clr();
	}
	
	OLED_CS_Clr();
	for(i = 0; i < 8; i++)
	{
		OLED_SCLK_Clr();
		if(data & 0x80)      //先写入D7
			OLED_SDIN_Set();
		else
			OLED_SDIN_Clr();
		OLED_SCLK_Set();
		data <<= 1;
	}
	
	OLED_CS_Set();
	OLED_DC_Set();
	
}


//初始化SSD1306	
void bsp_InitOLED(void)
{
	// PD3,4，5,6,7  推挽输出   PD3为CS,PD5为DC ,PD6为SCLK, PD7为SDIN	 PD4为RS接高电平
	GPIO_InitTypeDef  GPIO_InitStructure;
	RCC_APB2PeriphClockCmd( RCC_ALL_PIN, ENABLE );
	
	GPIO_InitStructure.GPIO_Pin = GPIO_PIN_CS | GPIO_PIN_RS | GPIO_PIN_DC | GPIO_PIN_SCLK | GPIO_PIN_SDIN;  
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	
	GPIO_Init( GPIO_PORT_CS, &GPIO_InitStructure );	
	
	GPIO_SetBits( GPIO_PORT_CS, GPIO_PIN_RS );
	
	OLED_RST_Set();
	
	DelayMS(100);
	OLED_RST_Clr();
	DelayMS(100);
	OLED_RST_Set();
	
	//新写
	OLED_WR_Byte(0xAE, OLED_CMD);  //关闭显示
	OLED_WR_Byte(0x81, OLED_CMD);  //设置对比度
	OLED_WR_Byte(0xCF, OLED_CMD);
	OLED_WR_Byte(0x00, OLED_CMD);  //设置低列开始地址   00~0f
	OLED_WR_Byte(0x10, OLED_CMD);  //设置高列开始地址     10~1f	
	OLED_WR_Byte(0x20, OLED_CMD);  //设置内存地址模式
	OLED_WR_Byte(0x02, OLED_CMD);  //  02为页地址模式  Page Addressing Mode
	
	//OLED_WR_Byte(0x21, OLED_CMD);  //设置列开始和结束地址
	//OLED_WR_Byte(0x00, OLED_CMD);  //设置列开始地址
	//OLED_WR_Byte(0x7F, OLED_CMD);   //设置列结束地址	
	//OLED_WR_Byte(0x22, OLED_CMD);    //设置页开始和结束地址
	//OLED_WR_Byte(0x00, OLED_CMD);    //设置页开始地址
	//OLED_WR_Byte(0x07, OLED_CMD);		 //设置页结束地址
	
	OLED_WR_Byte(0x00, OLED_CMD);    //设置页开始地址在页地址模式
	OLED_WR_Byte(0x40, OLED_CMD);    //设置显示开始线  40~7F	
	OLED_WR_Byte(0xA1, OLED_CMD);    //设置Segment重映射  A0为正常，A1为翻转  与数据手册的介绍有所不同，说明理解有误	
	OLED_WR_Byte(0xA8, OLED_CMD);    //设置复用率
	OLED_WR_Byte(0x3F, OLED_CMD);    //设置为1/64	
	OLED_WR_Byte(0xC8, OLED_CMD);    //设置输出扫描方向  C0为正常 ，C8为翻转   与数据手册的介绍有所不同，说明理解有误
	OLED_WR_Byte(0xD3, OLED_CMD);    //设置显示位移
	OLED_WR_Byte(0x00, OLED_CMD);    //设置位移为0   00~63
	//为什么设置为可选的引脚配置？
	OLED_WR_Byte(0xDA, OLED_CMD);    //设置硬件配置
	OLED_WR_Byte(0x12, OLED_CMD);    //设置为 可选的引脚配置
	//为什么是100帧/秒？
	OLED_WR_Byte(0xD5,OLED_CMD);//设置显示时钟分频系数和振荡频率
	OLED_WR_Byte(0x80,OLED_CMD);//设置分频系数为1，时钟为100帧/秒
	//为什么这样配置？
	OLED_WR_Byte(0xD9,OLED_CMD);//设置预充电周期--set pre-charge period
	OLED_WR_Byte(0xF1,OLED_CMD);//设置预充电周期为15个时钟周期，放电为1个周期
	//为什么这样配置？
	OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
	OLED_WR_Byte(0x40,OLED_CMD);//Set VCOM Deselect Level	
	//哪里有这句命令？？？？？坑爹啊！！！！！缺少这句命令则整个都不行！！！！
	OLED_WR_Byte(0x8D,OLED_CMD);//--set Charge Pump enable/disable
	OLED_WR_Byte(0xA4,OLED_CMD);  //设置整个显示开  A4为按照内存内容  A5为忽略内存内容
	OLED_WR_Byte(0xA6, OLED_CMD);  //设置正常显示
	OLED_WR_Byte(0xAF,OLED_CMD);   //开启显示

	OLED_Clear();  //清屏
	OLED_Set_Pos(0, 0);  //设置位置
}  



//清屏函数,清完屏,整个屏幕是黑色的!和没点亮一样!!!	  
void OLED_Clear( void )
{
	uint8_t i, n;
	for(i = 0; i < 8; i++)
	{
		OLED_WR_Byte(0xb0 + i, OLED_CMD);  //设置页地址（0-7）
		OLED_WR_Byte(0x00, OLED_CMD);    //设置显示位置--列低地址
		OLED_WR_Byte(0x10, OLED_CMD);    //设置显示位置---列高地址
		
		for(n= 0; n < 128; n++)
			OLED_WR_Byte(0x00, OLED_DATA);    //清屏
	}
}

/*设置显示的位置*/
static void OLED_Set_Pos(unsigned char x, unsigned char y)
{
	OLED_WR_Byte(0xb0 + y, OLED_CMD);   //设置页地址
	OLED_WR_Byte(x & 0x0f, OLED_CMD);   //设置显示位置--列低地址
	OLED_WR_Byte((x & 0xf0) >> 4 | 0x10, OLED_CMD);   //设置显示位置--列高地址
}


//在指定位置显示一个字符,包括部分字符
//由于为16*16的字符英文中为8 * 16 的规格，即宽为8，长为16
//x:0~127-1=126  为列数
//y:0~6  为页数

static void OLED_ShowChar(uint8_t x, uint8_t y, uint8_t chr)
{
	unsigned char c = 0, i = 0;
	c = chr - ' ';  //得到偏移后的值
	
	if(x > Max_Column - 1)  //减1才对，减9不对
	{
		x = 0;
		y = y + 2;
	}
	
	OLED_Set_Pos(x, y);
		
	for(i = 0; i < 8; i++)
		OLED_WR_Byte(F8X16[c * 16 + i], OLED_DATA);
		
	OLED_Set_Pos(x, y + 1);
		
	for(i = 0; i < 8; i++)
		OLED_WR_Byte(F8X16[c * 16 + 8 + i], OLED_DATA);
	
}

//显示字符串
static void OLED_ShowString(uint8_t x, uint8_t y, uint8_t *chr)
{
	unsigned char j = 0;
	while(chr[j] != '\0')
	{
		OLED_ShowChar(x, y, chr[j]);
		x += 8;
		j++;
	}
}


//显示单个汉字  规格为16*16
static void OLED_ShowChinese(uint8_t x, uint8_t y, uint8_t no)
{
	uint8_t i;
	
	if(x > Max_Column - 9)
	{
		x = 0;
		y = y + 2;
	}
	
	OLED_Set_Pos(x, y);
	for(i = 0; i < 16; i++)
		OLED_WR_Byte(CHNX16[2 * no][i], OLED_DATA);
	
	OLED_Set_Pos(x, y + 1);
	for(i = 0; i < 16; i++)
		OLED_WR_Byte(CHNX16[2 * no + 1][i], OLED_DATA); 
	/*u8 t,adder=0;
	OLED_Set_Pos(x,y);	
    for(t=0;t<16;t++)
		{
				OLED_WR_Byte(CHNX16[2*no][t],OLED_DATA);
				adder+=1;
     }	
		OLED_Set_Pos(x,y+1);	
    for(t=0;t<16;t++)
			{	
				OLED_WR_Byte(CHNX16[2*no+1][t],OLED_DATA);
				adder+=1;
      }			 */
	
}

#ifndef BMP
/***********功能描述：显示显示BMP图片128×64起始点坐标(x,y),x的范围0～128，y为页的范围0～8***************
***************参数  x0 起始列地址  y0为起始页地址 x1 为结束列地址  y1 为结束页地址  ********************/
static void OLED_ShowBMP(unsigned char x0, unsigned char y0, unsigned char x1, unsigned char y1, unsigned char BMP[])
{
	
	uint32_t j = 0;
	unsigned char x,y;
	
	for(y = y0; y < y1; y++)
	{
		OLED_Set_Pos(x0,y);
		for(x = x0; x < x1; x++)
		{
			
			OLED_WR_Byte(BMP[j++], OLED_DATA);
		}
			
	}
}
#endif
//m^n函数
static uint32_t OLED_Pow(uint8_t m,uint8_t n)
{
	uint32_t result=1;	 
	while(n--)
		result*=m;    
	return result;
}	

/************功能描述：显示8*16规格的数字  起始坐标为（x,y）  显示的数字为num***************/
static void OLED_ShowNum(uint8_t x, uint8_t y, uint32_t num)
{
	uint8_t n, temp, len = 0;
	uint32_t m;
	m = num;
	
	if(m == 0)
		len = 1;
	else
	{
		while(m)
		{
			m /= 10;
			len++;
		}
	}

	for(n = 0; n < len; n++)
	{
		temp = (num / OLED_Pow(10, len - n - 1)) % 10;
		OLED_ShowChar(x, y, temp + '0');
		x += 8;
	}
}

static void OLED_ShowPic(u8 x,u8 y,u8 chNum)
{      	
	unsigned char i=0;
	if(x>Max_Column-1)
	{
		x=0;
		y=y+2;
	}
	OLED_Set_Pos(x,y);
	for(i=0;i<8;i++)
		OLED_WR_Byte(myPic[chNum*16+i],OLED_DATA);
	OLED_Set_Pos(x,y+1);
	for(i=0;i<8;i++)
		OLED_WR_Byte(myPic[chNum*16+i+8],OLED_DATA);
}

void OLED_Show_Info( DHT11_Data_TypeDef *DHT11_Data, Air_Quality_TypeDef *Air_Struct )
{
	OLED_ShowChinese(0,0,0);  // 温
	OLED_ShowChinese(18,0,1);   //度
	OLED_ShowChinese(36,0,2);   //为
	OLED_ShowNum(54,0,DHT11_Data->temp_int);  //温度整数部分数值
	OLED_ShowChar(72,0,'.');  //小数点
	OLED_ShowNum(80,0,DHT11_Data->temp_deci);  //温度小数部分数值
	OLED_ShowPic(88, 0, 0);
	OLED_ShowChar(96, 0,'C');//C
	//OLED_ShowChinese(91,0,1);   //单位：度
	
	OLED_ShowChinese(0,3,3);  //湿
	OLED_ShowChinese(18,3,1);  //度
	OLED_ShowChinese(36,3,2);   //为
	OLED_ShowNum(54,3,DHT11_Data->humi_int);  //湿度整数部分数值
	OLED_ShowChar(72,3,'.');  //小数点
	OLED_ShowNum(80,3,DHT11_Data->humi_deci);  //湿度小数部分数值
	OLED_ShowString(91,3,(unsigned char *)"RH");  //单位
	
	OLED_ShowChinese( 0, 6, 8 );   				//空
	OLED_ShowChinese( 18, 6, 9 );  	//气
	OLED_ShowChinese( 36, 6, 10 ); 	//质
	OLED_ShowChinese( 54, 6, 11 ); 	//量
	OLED_ShowChar( 72, 6,':' );   	//冒号
	
	if( Air_Struct->quality == 0 )    //持续高电平，判定为烟
	{	
		OLED_ShowChinese(88,6,14);   //差
	}
	else if( Air_Struct->quality == 2 )   //持续为低电平，判定为无灰尘
	{
		OLED_ShowChinese(88,6,15);   //优
	}
	else
	{
		OLED_ShowChinese(88,6,12);   //良
	}
}

void OLED_Show_CH2O( uint32_t* ch2o_m, Air_Quality_TypeDef *Air_Struct )
{
	uint8_t lastX;
	uint8_t Str_CH2O[] = "CH2O:";
	uint8_t Str_Unit[] = "mg/m3";
	uint8_t Idx_Chinese[4] = {16,17,18,19};

	//Line 1: Print the parameter of CH2O
	lastX = OLED_Print_Char( 0, 0, Str_CH2O, sizeof(Str_CH2O) );
	OLED_ShowNum( lastX, 0, (*ch2o_m)/10000 );
	lastX += CHAR_WIDTH;
	OLED_ShowChar( lastX, 0, '.');
	lastX += CHAR_WIDTH/2;
	OLED_ShowNum( lastX, 0, (*ch2o_m)%10000/1000 );
	lastX += CHAR_WIDTH;
	OLED_ShowNum( lastX, 0, (*ch2o_m)%1000/100 );
	lastX += CHAR_WIDTH;
	OLED_ShowNum( lastX, 0, (*ch2o_m)%100/10 );
	lastX += CHAR_WIDTH;
	OLED_ShowNum( lastX, 0, (*ch2o_m)%10 );
	lastX += CHAR_WIDTH;
	lastX = OLED_Print_Char( lastX, 0, Str_Unit, sizeof(Str_Unit) );

	//Line2: Print the Chinese of dust density
	lastX = OLED_Print_Chinese( 0, 3, Idx_Chinese, sizeof(Idx_Chinese) );

	//Line3: Print the parameter of dust density
	lastX = 0;
	OLED_ShowNum( lastX, 6, Air_Struct->Dust_Density_Disp/1000 );
	lastX += CHAR_WIDTH;
	OLED_ShowChar( lastX, 6,'.' );   	//
	lastX += CHAR_WIDTH/2;
	OLED_ShowNum( lastX, 6, Air_Struct->Dust_Density_Disp%1000/100 );
	lastX += CHAR_WIDTH;
	OLED_ShowNum( lastX, 6, Air_Struct->Dust_Density_Disp%100/10 );
	lastX += CHAR_WIDTH;
	OLED_ShowNum( lastX, 6, Air_Struct->Dust_Density_Disp%10 );
	lastX += CHAR_WIDTH;
	
	OLED_Print_Char( lastX, 6, Str_Unit, sizeof(Str_Unit) );
}

static uint8_t OLED_Print_Chinese( uint8_t startX, uint8_t startY, uint8_t Chinese_Index[], uint8_t Length )
{
	uint8_t i;
	for( i = 0; i < Length; ++i )
	{
		OLED_ShowChinese( startX, startY, Chinese_Index[i] );
		startX += FONT_WIDTH;
		if((startX+FONT_WIDTH) > 128 )
			break;
	}
	return startX;
}

static uint8_t OLED_Print_Char( uint8_t startX, uint8_t startY, uint8_t Str[], uint8_t Length )
{
	uint8_t i;
	--Length;
	for( i = 0; i < Length; ++i )
	{
		OLED_ShowChar( startX, startY, Str[i] );
		if( Str[i] == '.' )
			startX += CHAR_WIDTH/2;
		else
			startX += CHAR_WIDTH;
		//avoid the character being printed overflow
		if( (startX + CHAR_WIDTH) > 128 )
			break;
	}
	return startX;
}
